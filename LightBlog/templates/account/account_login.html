{% extends "base.html" %}
{% load staticfiles %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="flex-center">
    <div class="container">
    <div class="flex-center">
    <div class="unit-1-2 unit-1-on-mobile">
        <h1>{{title}}</h1>
            <!--{% if tips %}-->
        <!--<div>{{ tips }}</div>-->
            <!--{% endif %}-->
        <form class="form" action="" method="post">
            {% csrf_token %}
            <div>用户名:<input type="text" id="username" ></div>
            {% if register %}
                <div>邮 箱:<input type="email" id="email" ></div>
            {% endif %}
            <div>密 码:<input type="password" id="password" ></div>
            {% if new_password %}
                <div>{{ password_tips }}<input type="password" id="new_password" ></div>
            {% endif %}
            <button type="button" class="btn btn-primary btn-block" onclick="post_submit()">确定</button>
        </form>
        <div class="flex-left top-gap text-small">
            <div class="unit-2-3">
                <a href="{{ unit_2 }}">{{ unit_2_name }}</a>
            </div>
            <div class="unit-1-3 flex-right">
                <a href="{{ unit_1 }}">{{ unit_1_name }}</a>
            </div>
        </div>
    </div>
    </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
<link rel="stylesheet" href="https://unpkg.com/mobi.css/dist/mobi.min.css">
<script type="text/javascript" src='{% static "js/jquery.js" %}'></script>
<script type="text/javascript" src="{% static 'js/layer.js'%}"></script>
<script type="text/javascript">
function post_submit(){
    if($('#email').length>0){ //判断是否有email的input标签，来知道是否是登录还是注册
        var username = $('#username').val();
        var email = $('#email').val();
        var password = $('#password').val();
        var new_password = $('#new_password').val();
        $.ajax({
            url: "{% url 'account:account_register' %}",
            type: "POST",
            data: {'username':username, 'email_input':email, 'password':password, 'new_password':new_password},
            success: function(e){
                res = JSON.parse(e);
                if(res.status!="5"){
                    layer.msg(res.tips);
                }else{
                    location.href = "{% url 'blog:blog_list' %}";
                }
            },
        });
    }else{
        var username = $('#username').val();
        var password = $('#password').val();
        $.ajax({
            url: "{% url 'account:account_login' %}",
            type: "POST",
            data: {"username":username,"password":password},
            success: function(e){
                res = JSON.parse(e);
                if(res.status != 1){
                    layer.msg(res.tips);
                }else{
                    location.href = "{% url 'blog:blog_list' %}";
                }
            },
        });
    }
}
</script>
{% endblock %}