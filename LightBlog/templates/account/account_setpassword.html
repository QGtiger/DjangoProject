{% extends "base.html" %}
{% load staticfiles %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="flex-center">
    <div class="container">
    <div class="flex-center">
    <div class="unit-1-2 unit-1-on-mobile">
        <h1>{{ title }}</h1>
            {% if tips %}
        <div>{{ tips }}</div>
            {% endif %}
        <form class="form" action="{% url 'account:account_setpassword' %}" method="post">
            {% csrf_token %}
            <div>用户名:<input type="text" name='username' id="username" value="{{ username }}"></div>
            <div>验证码:<input type="text" name='VerificationCode' id="code"></div>

            <div>新密码:<input type="password" id="password" name='password'></div>
            <div>重复密码:<input type="password" id="re_password" name='re_password'></div>

            <button type="button" class="btn btn-primary btn-block change-btn" onclick="setpassword()">{{ button }}</button>
        </form>
        <div class="flex-left top-gap text-small">
            <div class="unit-2-3">
                <a href="{{ unit_2 }}">{{ unit_2_name }}</a>
            </div>
            <div class="unit-1-3 flex-right">
                <a href="{{ unit_1 }}">{{ unit_1_name }}</a>
            </div>
        </div>
    </div>
    </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
<link rel="stylesheet" href="https://unpkg.com/mobi.css/dist/mobi.min.css">
<script type="text/javascript" src='{% static "js/jquery.js" %}'></script>
<script type="text/javascript" src="{% static 'js/layer.js'%}"></script>
<script type="text/javascript">
    function setpassword(){
        $('.change-btn').val("12321");
        var username = $('#username').val();
        var code = $('#code').val();
        var password = $('#password').val();
        var re_password = $('#re_password').val();
        $.ajax({
            url: "{% url 'account:account_setpassword' %}",
            type: "POST",
            data: {"username":username,"code":code,"password":password,"re_password":re_password},
            success: function(e){
                res = JSON.parse(e);
                console.log(res);
                if(res.status=="1"){
                    layer.msg(res.tips);
                }else if(res.status=="2"){
                    layer.msg(res.tips);
                    location.href = "{% url 'blog:blog_list' %}";
                }else if(res.status=="3"){
                    layer.msg(res.tips);
                }else if(res.status=="4"){
                    layer.msg(res.tips);
                    location.href = "{% url 'account:account_setpassword' %}";
                }else{

                    layer.msg(res.tips);
                }
            }
        });
    }
</script>
{% endblock %}